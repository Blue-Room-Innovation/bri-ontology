## Waste / MARPOL SHACL Shapes (sin legado DPP)
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix dct:     <http://purl.org/dc/terms/> .
@prefix schema:  <http://schema.org/> .
@prefix dwp:     <https://ontology.circularpass.io/digital-waste-passport/> .
@prefix dmwp:    <https://ontology.circularpass.io/digital-marpol-waste-passport/> .
@prefix untp:    <https://ontology.untp.io/core/> .

# =============================================================
# Núcleo Digital Waste Passport
# =============================================================

dwp:DigitalWastePassportShape a sh:NodeShape ;
  sh:targetClass dwp:DigitalWastePassport ;
  sh:name "Digital Waste Passport"@es ;
  sh:property [ sh:path dct:issued ; sh:datatype xsd:dateTime ; sh:minCount 1 ] ;
  sh:property [ sh:path dct:publisher ; sh:minCount 1 ] ;
  sh:property [ sh:path dwp:credentialSubject ; sh:minCount 1 ; sh:class dwp:WastePassport ] ;
  sh:property [ sh:path dct:valid ; sh:minCount 0 ; sh:datatype xsd:dateTime ] ;
  sh:closed false .

dwp:WastePassportShape a sh:NodeShape ;
  sh:targetClass dwp:WastePassport ;
  sh:name "Waste Passport"@es ;
  sh:property [ sh:path dwp:waste ; sh:minCount 1 ; sh:class dwp:Waste ] ;
  sh:property [ sh:path dct:identifier ; sh:minCount 0 ; sh:datatype xsd:string ] ;
  sh:closed false .

dwp:WasteShape a sh:NodeShape ;
  sh:targetClass dwp:Waste ;
  sh:name "Waste"@es ;
  sh:property [ sh:path schema:name ; sh:minCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dct:description ; sh:minCount 0 ; sh:datatype xsd:string ] ;
  sh:closed false .

# =============================================================
# Extensión MARPOL
# =============================================================

dmwp:DigitalMarpolWastePassportShape a sh:NodeShape ;
  sh:targetClass dmwp:DigitalMarpolWastePassport ;
  sh:name "Digital MARPOL Waste Passport"@es ;
  sh:property [ sh:path dmwp:credentialSubject ; sh:minCount 1 ; sh:class dmwp:MarpolWastePassport ] ;
  sh:property [ sh:path dct:issued ; sh:datatype xsd:dateTime ; sh:minCount 1 ] ;
  sh:property [ sh:path dct:publisher ; sh:minCount 1 ] ;
  sh:closed false .

dmwp:MarpolWastePassportShape a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWastePassport ;
  sh:name "MARPOL Waste Passport"@es ;
  sh:property [ sh:path dmwp:waste ; sh:minCount 1 ; sh:class dmwp:MarpolWaste ] ;
  sh:closed false .

dmwp:MarpolWasteShape a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWaste ;
  sh:name "MARPOL Waste"@es ;
  sh:property [ sh:path dmwp:ship ; sh:minCount 1 ; sh:class dmwp:Ship ] ;
  sh:property [ sh:path dmwp:residue ; sh:minCount 1 ; sh:class dmwp:ResidueInformation ] ;
  sh:property [ sh:path dmwp:lastDeliveryDate ; sh:minCount 0 ; sh:datatype xsd:dateTime ] ;
  sh:property [ sh:path dmwp:arrivalPort ; sh:minCount 0 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ] ; # UN/LOCODE pattern
  sh:property [ sh:path dmwp:nextPlannedDeliveryPort ; sh:minCount 0 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ] ; # UN/LOCODE pattern
  sh:property [ sh:path dmwp:wasteAgent ; sh:minCount 0 ; sh:class dmwp:AuthorizedParty ] ;
  sh:closed false .

dmwp:ResidueInformationShape a sh:NodeShape ;
  sh:targetClass dmwp:ResidueInformation ;
  sh:name "Residue Information"@es ;
  # Enumeraciones desde vocabularios SKOS (inline por simplicidad)
  sh:property [ sh:path dmwp:typeCode ; sh:minCount 1 ; sh:datatype xsd:string ; sh:in ( "ZTH" "ZTE" "ZTR" "ZTW" ) ] ;
  sh:property [ sh:path dmwp:subtypeCode ; sh:minCount 0 ; sh:datatype xsd:string ; sh:in ( "ZTH01" "ZTE02" "ZTR03" "ZTW04" ) ] ;
  sh:property [ sh:path dmwp:dischargeMeans ; sh:minCount 0 ; sh:datatype xsd:string ; sh:in ( "ZTE" "ZTD" "ZTC" "ZTB" ) ] ;
  sh:or (
    [ sh:property [ sh:path dmwp:quantityToDeliver ; sh:minCount 1 ; sh:class untp:Measure ] ]
    [ sh:property [ sh:path dmwp:quantityRemainingOnBoard ; sh:minCount 1 ; sh:class untp:Measure ] ]
    [ sh:property [ sh:path dmwp:estimatedGenerated ; sh:minCount 1 ; sh:class untp:Measure ] ]
  ) ;
  sh:closed false .

dmwp:ShipShape a sh:NodeShape ;
  sh:targetClass dmwp:Ship ;
  sh:name "Ship"@es ;
  sh:property [ sh:path dmwp:imoNumber ; sh:minCount 1 ; sh:datatype xsd:string ; sh:pattern "^\\d{7}$" ] ;
  sh:property [ sh:path dmwp:name ; sh:minCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:flag ; sh:minCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}$" ] ;
  sh:closed false .

dmwp:AuthorizedPartyShape a sh:NodeShape ;
  sh:targetClass dmwp:AuthorizedParty ;
  sh:name "Authorized Party"@es ;
  sh:property [ sh:path dmwp:identifier ; sh:minCount 1 ; sh:datatype xsd:string ] ;
  sh:closed false .

dmwp:InvolvedPartyShape a sh:NodeShape ;
  sh:targetClass dmwp:InvolvedParty ;
  sh:name "Involved Party"@es ;
  sh:property [ sh:path dmwp:role ; sh:minCount 0 ] ;
  sh:closed false .

# Validación codelists aplicada (typeCode, subtypeCode, dischargeMeans, arrivalPort/nextPlannedDeliveryPort patrones). Pendiente futura validación referenciada ISO3166 y UN/LOCODE con conceptos explícitos.
# =============================================================
# FIN SHAPES Waste / MARPOL
# =============================================================

# (Contenido legado DPP eliminado)