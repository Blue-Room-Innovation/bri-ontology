#######################################################################
# Digital Waste Passport – MARPOL REGULATORY SHACL PROFILE
#
# CONTEXT
# -------
# This SHACL file defines a MARPOL-SPECIFIC REGULATORY PROFILE
# for the Digital Waste Passport (DWP).
#
# It captures constraints related to ship-generated waste as
# regulated under the MARPOL Convention (IMO), focusing on:
#   - ship identification
#   - waste residues
#   - delivery and collection ports
#   - quantities and capacities
#
# RELATION TO OTHER SHAPES
# -----------------------
# - This file MUST be applied on top of:
#     • dwp-governed.shacl.ttl        (normative waste governance)
#     • digitalWastePassport.ttl     (DWP ontology)
#     • digitalMarpolWastePassport.ttl (MARPOL extension ontology)
#
# - This file DOES NOT inherit UNECE DPP bootstrap constraints
# - This file is a REGULATORY PROFILE, not a generic data model
#
# GOVERNANCE ROLE
# ---------------
# - This file is NORMATIVE for MARPOL compliance
# - Shapes are intentionally CLOSED
# - Unexpected properties MUST trigger validation errors
#
# DESIGN PRINCIPLES
# -----------------
# - Strong structural validation
# - Explicit enumerations (even when partial / placeholder)
# - Pattern-based validation for regulated identifiers
# - Logical constraints (OR) where MARPOL allows alternatives
#
# NOTE ON ENUMERATIONS
# -------------------
# Some enumerations are intentionally PARTIAL (placeholders).
# These are expected to be replaced or externalised into
# authoritative codelists in future iterations.
#
#######################################################################

@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix dct:     <http://purl.org/dc/terms/> .
@prefix schema:  <http://schema.org/> .

@prefix dmwp:    <https://blue-room-innovation.github.io/bri-ontology/ontology/v0.1/digitalMarpolWastePassport.ttl#> .
@prefix untp:    <https://ontology.untp.io/core/> .

#######################################################################
# Digital MARPOL Waste Passport (top-level wrapper)
#######################################################################

dmwp:DigitalMarpolWastePassportShape
  a sh:NodeShape ;
  sh:targetClass dmwp:DigitalMarpolWastePassport ;

  sh:name "Digital MARPOL Waste Passport"@en ;
  sh:description """
  Top-level governed shape for a Digital MARPOL Waste Passport.
  This shape is CLOSED to enforce strict regulatory compliance.
  """@en ;

  # Exactly one MARPOL Waste Passport as credential subject
  sh:property [
    sh:path dmwp:credentialSubject ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:class dmwp:MarpolWastePassport ;
    sh:message "A Digital MARPOL Waste Passport must reference exactly one MarpolWastePassport."@en
  ] ;

  # Issuance metadata
  sh:property [
    sh:path dct:issued ;
    sh:datatype xsd:dateTime ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:message "The MARPOL Waste Passport must declare an issuance date (dct:issued)."@en
  ] ;

  sh:property [
    sh:path dct:publisher ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:message "The MARPOL Waste Passport must declare a publisher (dct:publisher)."@en
  ] ;

  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

#######################################################################
# MARPOL Waste Passport (domain container)
#######################################################################

dmwp:MarpolWastePassportShape
  a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWastePassport ;

  sh:name "MARPOL Waste Passport"@en ;
  sh:description """
  Container shape for MARPOL-regulated waste information.
  """@en ;

  sh:property [
    sh:path dmwp:waste ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:class dmwp:MarpolWaste ;
    sh:message "A MarpolWastePassport must reference exactly one MarpolWaste entity."@en
  ] ;

  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

#######################################################################
# MARPOL Waste (core regulated entity)
#######################################################################

dmwp:MarpolWasteShape
  a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWaste ;

  sh:name "MARPOL Waste"@en ;
  sh:description """
  Governed shape for MARPOL-regulated ship-generated waste.
  """@en ;

  # Ship generating the waste
  sh:property [
    sh:path dmwp:ship ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:class dmwp:Ship ;
    sh:message "MARPOL waste must specify the generating ship."@en
  ] ;

  # One or more waste residue entries
  sh:property [
    sh:path dmwp:residue ;
    sh:minCount 1 ;
    sh:class dmwp:ResidueInformation ;
    sh:message "At least one ResidueInformation entry is required."@en
  ] ;

  sh:property [
    sh:path dmwp:lastDeliveryDate ;
    sh:datatype xsd:dateTime ;
    sh:maxCount 1
  ] ;

  ###################################################################
  # Port codes (UN/LOCODE)
  ###################################################################

  sh:property [
    sh:path dmwp:arrivalPort ;
    sh:datatype xsd:string ;
    sh:maxCount 1 ;
    sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ;
    sh:message "arrivalPort must follow UN/LOCODE pattern (e.g. ESPMI)."@en
  ] ;

  sh:property [
    sh:path dmwp:nextPlannedDeliveryPort ;
    sh:datatype xsd:string ;
    sh:maxCount 1 ;
    sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$"
  ] ;

  sh:property [
    sh:path dmwp:lastWasteDeliveryPort ;
    sh:datatype xsd:string ;
    sh:maxCount 1 ;
    sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$"
  ] ;

  ###################################################################
  # Delivery type (controlled list – placeholder)
  ###################################################################

  sh:property [
    sh:path dmwp:deliveryType ;
    sh:datatype xsd:string ;
    sh:maxCount 1 ;
    sh:in ( "ZTO" "REC" "DIS" ) ;
    sh:message "deliveryType must be one of: ZTO, REC, DIS."@en
  ] ;

  ###################################################################
  # Additional contextual properties (allowed)
  ###################################################################

  sh:property [ sh:path dmwp:shipScale ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:marpolEdition ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:wasteAgent ; sh:maxCount 1 ; sh:class dmwp:AuthorizedParty ] ;
  sh:property [ sh:path dmwp:message ; sh:maxCount 1 ] ;
  sh:property [ sh:path dmwp:involvedParty ] ;

  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

#######################################################################
# Residue Information (individual waste batches)
#######################################################################

dmwp:ResidueInformationShape
  a sh:NodeShape ;
  sh:targetClass dmwp:ResidueInformation ;

  sh:name "Residue Information"@en ;
  sh:description """
  Information about an individual waste residue batch.
  """@en ;

  # Waste classification (placeholder enumeration)
  sh:property [
    sh:path dmwp:typeCode ;
    sh:datatype xsd:string ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:in ( "OIL" ) ;
    sh:message "typeCode must be OIL (placeholder enumeration)."
  ] .