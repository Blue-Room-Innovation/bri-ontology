## Waste / MARPOL SHACL Shapes (without legacy DPP)
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix dct:     <http://purl.org/dc/terms/> .
@prefix schema:  <http://schema.org/> .
@prefix dmwp:    <https://blue-room-innovation.github.io/bri-ontology/ontology/v0.1/digitalMarpolWastePassport.ttl#> .
@prefix untp:    <https://ontology.untp.io/core/> .

# Refined: closed shapes, enumerations aligned to example and local codelists.
# Messages, maxCount and pattern validations are added.


dmwp:DigitalMarpolWastePassportShape a sh:NodeShape ;
  sh:targetClass dmwp:DigitalMarpolWastePassport ;
  sh:name "Digital MARPOL Waste Passport"@en ;
  sh:description "Main shape of the Digital MARPOL Waste Passport (closed)."@en ;
  sh:property [ sh:path dmwp:credentialSubject ; sh:minCount 1 ; sh:maxCount 1 ; sh:class dmwp:MarpolWastePassport ; sh:message "Must have a credentialSubject (MarpolWastePassport)."@en ] ;
  sh:property [ sh:path dct:issued ; sh:datatype xsd:dateTime ; sh:minCount 1 ; sh:maxCount 1 ; sh:message "Missing issued date (dct:issued)."@en ] ;
  sh:property [ sh:path dct:publisher ; sh:minCount 1 ; sh:maxCount 1 ; sh:message "Missing publisher (dct:publisher)."@en ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:MarpolWastePassportShape a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWastePassport ;
  sh:name "MARPOL Waste Passport"@en ;
  sh:description "MarpolWastePassport shape (closed)."@en ;
  sh:property [ sh:path dmwp:waste ; sh:minCount 1 ; sh:maxCount 1 ; sh:class dmwp:MarpolWaste ; sh:message "Must link a MarpolWaste."@en ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:MarpolWasteShape a sh:NodeShape ;
  sh:targetClass dmwp:MarpolWaste ;
  sh:name "MARPOL Waste"@en ;
  sh:description "MARPOL waste shape (closed)."@en ;
  sh:property [ sh:path dmwp:ship ; sh:minCount 1 ; sh:maxCount 1 ; sh:class dmwp:Ship ; sh:message "Must specify the ship (ship)."@en ] ;
  sh:property [ sh:path dmwp:residue ; sh:minCount 1 ; sh:class dmwp:ResidueInformation ; sh:message "Must have at least one ResidueInformation."@en ] ;
  sh:property [ sh:path dmwp:lastDeliveryDate ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:dateTime ] ;
  # UN/LOCODE ports (uppercase country+3) + additional validation partial enumeration example
  sh:property [ sh:path dmwp:arrivalPort ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ; sh:message "arrivalPort must match UN/LOCODE pattern (e.g. ESPMI)."@en ] ;
  sh:property [ sh:path dmwp:nextPlannedDeliveryPort ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ] ;
  sh:property [ sh:path dmwp:lastWasteDeliveryPort ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ] ;
  sh:property [ sh:path dmwp:deliveryType ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:in ( "ZTO" "REC" "DIS" ) ; sh:message "deliveryType outside allowed list (ZTO, REC, DIS)."@en ] ;
  # Additional properties from the example (now allowed)
  sh:property [ sh:path dmwp:shipScale ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:marpolEdition ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:wasteAgent ; sh:minCount 0 ; sh:maxCount 1 ; sh:class dmwp:AuthorizedParty ] ;
  sh:property [ sh:path dmwp:message ; sh:minCount 0 ; sh:maxCount 1 ] ;
  sh:property [ sh:path dmwp:involvedParty ; sh:minCount 0 ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:ResidueInformationShape a sh:NodeShape ;
  sh:targetClass dmwp:ResidueInformation ;
  sh:name "Residue Information"@en ;
  sh:description "Information for each waste batch (closed)."@en ;
  # Refined enumerations (real placeholder: OIL + SLU vs internal codelists)
  sh:property [ sh:path dmwp:typeCode ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:in ( "OIL" ) ; sh:message "typeCode must be OIL (placeholder)."@en ] ;
  sh:property [ sh:path dmwp:subtypeCode ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:in ( "SLU" ) ; sh:message "subtypeCode must be SLU (placeholder)."@en ] ;
  sh:property [ sh:path dmwp:substance ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:dischargeMeans ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:in ( "ZTE" "ZTD" "ZTC" "ZTB" ) ] ;
  sh:property [ sh:path dmwp:nextCollectionPort ; sh:minCount 0 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}[A-Z0-9]{3}$" ] ;
  # At least one quantity measure (logical OR)
  sh:or (
    [ sh:property [ sh:path dmwp:quantityToDeliver ; sh:minCount 1 ; sh:class untp:Measure ] ]
    [ sh:property [ sh:path dmwp:quantityRemainingOnBoard ; sh:minCount 1 ; sh:class untp:Measure ] ]
    [ sh:property [ sh:path dmwp:estimatedGenerated ; sh:minCount 1 ; sh:class untp:Measure ] ]
  ) ;
  sh:property [ sh:path dmwp:quantityToDeliver ; sh:minCount 0 ; sh:maxCount 1 ; sh:class untp:Measure ] ;
  sh:property [ sh:path dmwp:quantityRemainingOnBoard ; sh:minCount 0 ; sh:maxCount 1 ; sh:class untp:Measure ] ;
  sh:property [ sh:path dmwp:estimatedGenerated ; sh:minCount 0 ; sh:maxCount 1 ; sh:class untp:Measure ] ;
  sh:property [ sh:path dmwp:maxCapacity ; sh:minCount 0 ; sh:maxCount 1 ; sh:class untp:Measure ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:ShipShape a sh:NodeShape ;
  sh:targetClass dmwp:Ship ;
  sh:name "Ship"@en ;
  sh:description "Ship data (closed)."@en ;
  sh:property [ sh:path dmwp:imoNumber ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^\\d{7}$" ; sh:message "IMO must be 7 digits."@en ] ;
  sh:property [ sh:path dmwp:name ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:flag ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ; sh:pattern "^[A-Z]{2}$" ; sh:message "flag must be ISO 3166-1 alpha-2."@en ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:AuthorizedPartyShape a sh:NodeShape ;
  sh:targetClass dmwp:AuthorizedParty ;
  sh:name "Authorized Party"@en ;
  sh:description "Authorized entity (closed)."@en ;
  sh:property [ sh:path dmwp:identifier ; sh:minCount 1 ; sh:maxCount 1 ; sh:datatype xsd:string ] ;
  sh:property [ sh:path dmwp:contactPoint ; sh:minCount 0 ; sh:maxCount 1 ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .

dmwp:InvolvedPartyShape a sh:NodeShape ;
  sh:targetClass dmwp:InvolvedParty ;
  sh:name "Involved Party"@en ;
  sh:description "Involved party (closed)."@en ;
  sh:property [ sh:path dmwp:role ; sh:minCount 0 ; sh:maxCount 1 ] ;
  sh:ignoredProperties ( rdf:type ) ;
  sh:closed true .