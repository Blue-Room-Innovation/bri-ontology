#######################################################################
# Digital Product Passport â€“ SHACL BOOTSTRAP
#
# SOURCE
# ------
# This file is BOOTSTRAPPED from the official UNECE UNTP
# Digital Product Passport JSON Schema (v0.6.0):
#
#   https://test.uncefact.org/vocabulary/untp/dpp/untp-dpp-schema-0.6.0.json
#
# The source schema is defined in JSON Schema draft 2020-12 and is
# primarily intended for validating Digital Product Passports expressed
# as W3C Verifiable Credentials serialized in JSON-LD.
#
# PURPOSE
# -------
# This file provides an INITIAL SHACL PROFILE that:
#   - Mirrors EXPLICIT STRUCTURAL constraints from the UNECE JSON Schema
#   - Enables early graph-based validation of JSON-LD DPP instances
#   - Serves as a BOOTSTRAP artefact for semantic governance (IT0_00)
#
# IMPORTANT LIMITATIONS
# ---------------------
# - This is NOT a semantic conversion of the JSON Schema
# - No OWL semantics, class hierarchies or inference are expressed here
# - Constraints described only in natural language are NOT enforced
# - JSON-LD @context ordering and content are NOT strictly validated
#
# GOVERNANCE RULE
# ---------------
# - THIS FILE IS IMMUTABLE
# - It MUST NOT be modified to add business, regulatory or domain rules
# - All additional constraints MUST be defined in separate SHACL files
#   (e.g. dpp-governed.shacl.ttl, sector profiles, national profiles)
#
# DESIGN PRINCIPLE
# ----------------
# - Shapes in this file are intentionally LEFT OPEN (sh:closed false)
# - Closure and stricter constraints are applied in governed profiles
#
#######################################################################

@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix dct:     <http://purl.org/dc/terms/> .

@prefix vc:      <https://www.w3.org/2018/credentials#> .
@prefix unece:   <https://test.uncefact.org/vocabulary/untp/core/0/> .
@prefix unece-dpp: <https://test.uncefact.org/vocabulary/untp/dpp/0/> .

#######################################################################
# Digital Product Passport (Verifiable Credential wrapper)
#######################################################################

unece-dpp:DigitalProductPassportShape
  a sh:NodeShape ;
  sh:targetClass unece-dpp:DigitalProductPassport ;
  sh:closed false ;   # OPEN BY DESIGN (see governance notes above)

  # id (JSON Schema: "id", format: uri)
  sh:property [
    sh:path dct:identifier ;
    sh:datatype xsd:anyURI ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
  ] ;

  # issuer (JSON Schema: issuer)
  sh:property [
    sh:path vc:issuer ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:node unece-dpp:CredentialIssuerShape ;
  ] ;

  # validFrom / validUntil
  sh:property [
    sh:path vc:validFrom ;
    sh:datatype xsd:dateTime ;
    sh:maxCount 1 ;
  ] ;

  sh:property [
    sh:path vc:validUntil ;
    sh:datatype xsd:dateTime ;
    sh:maxCount 1 ;
  ] ;

  # credentialSubject
  sh:property [
    sh:path vc:credentialSubject ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:node unece-dpp:ProductPassportShape ;
  ] .

#######################################################################
# Credential Issuer (derived from $defs/CredentialIssuer)
#######################################################################

unece-dpp:CredentialIssuerShape
  a sh:NodeShape ;
  sh:closed false ;

  sh:property [
    sh:path dct:identifier ;
    sh:datatype xsd:anyURI ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
  ] ;

  sh:property [
    sh:path unece:name ;
    sh:datatype xsd:string ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
  ] .

#######################################################################
# Product Passport (credentialSubject)
#######################################################################

unece-dpp:ProductPassportShape
  a sh:NodeShape ;
  sh:closed false ;

  sh:property [
    sh:path unece-dpp:product ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
    sh:node unece-dpp:ProductShape ;
  ] ;

  sh:property [
    sh:path unece-dpp:granularityLevel ;
    sh:datatype xsd:string ;
    sh:in ( "item" "batch" "model" ) ;
    sh:maxCount 1 ;
  ] .

#######################################################################
# Product (UNECE core concept)
#######################################################################

unece-dpp:ProductShape
  a sh:NodeShape ;
  sh:closed false ;

  sh:property [
    sh:path dct:identifier ;
    sh:datatype xsd:anyURI ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
  ] ;

  sh:property [
    sh:path unece:name ;
    sh:datatype xsd:string ;
    sh:minCount 1 ;
    sh:maxCount 1 ;
  ] .
